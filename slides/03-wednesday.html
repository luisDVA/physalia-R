<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Getting the most out of R</title>
    <meta charset="utf-8" />
    <meta name="author" content="Luis D. Verde Arregoitia" />
    <script src="03-wednesday_files/header-attrs/header-attrs.js"></script>
    <link href="03-wednesday_files/tachyons/tachyons.min.css" rel="stylesheet" />
    <script src="03-wednesday_files/clipboard/clipboard.min.js"></script>
    <link href="03-wednesday_files/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="03-wednesday_files/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <link href="03-wednesday_files/panelset/panelset.css" rel="stylesheet" />
    <script src="03-wednesday_files/panelset/panelset.js"></script>
    <link href="03-wednesday_files/animate.css-xaringan/animate.fade.css" rel="stylesheet" />
    <link href="03-wednesday_files/xaringanExtra-extra-styles/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Getting the most out of R
## Physalia Courses
### Luis D. Verde Arregoitia
### February 2021

---















&lt;style type="text/css"&gt;
.dk-section-title {
box-shadow: inset 0 0 0 1000px rgba(0,0,0,0.5);
}

.dk-section-title h1 {
  color: #f3f3f3;
  font-size: 100px;
  line-height: 1;
}

.smallcode .remark-code { /*Change made here*/
  font-size: 75% !important;
}

.tinycode .remark-code { /*Change made here*/
  font-size: 50% !important;
}

&lt;/style&gt;

## Wednesday - Increasing efficiency

- Iteration, writing loops and using {`purrr`}

  - Apply functions to many things at once

  - Reading many files at once

  - Modifying and exporting multiple objects

- ~~Useful addins and helpers~~

- Regular expressions for working with text strings 

---

class: inverse

# Challenge

.f3.white[
" `Airports.csv`" contains yearly rankings for total number of passengers at the world's busiest airports across several countries between 2016-2020.


1. Find the busiest (highest ranked) airports for each country and year .f4[(some countries have multiple entries per year)]

2. Which countries had &gt;1 different busiest airports (by airport code) in the time period covered by the data? 
]

---


```r
china &lt;-  airports[airports$Country=="China",]
china_years &lt;- china$Year

china2016 &lt;- china[china$Year==2016,] 
china2016busiest &lt;- 
  china2016[which(china2016$Rank==min(china2016$Rank)),]

china2017 &lt;- china[china$Year==2017,] 
china2017busiest &lt;- 
  china2017[which(china2017$Rank==min(china2017$Rank)),]

china2018 &lt;- china[china$Year==2018,] 
china2018busiest &lt;- 
  china2018[which(china2018$Rank==min(china2018$Rank)),]
```

---

## Iteration - perform a process repeatedly

Any time we copy and paste code, and then edit, we are adding unnecessary steps that add room for errors

.tr[
Nick Holt (2017)  
[Function Iterations in R](https://nick-holt.github.io/2017/12/function-iterations-in-r/)
]


---

## Grouped data

.f3[Most data analysis and manipulations tasks can be approached using the .b.purple[“split-apply-combine”] paradigm:] 

.f3[
- split the data into groups
- apply some analysis to each group
- combine the results
]

.tr[
Data Carpentry (2018)  
[Aggregating and analyzing data with dplyr](https://datacarpentry.org/R-genomics/04-dplyr.html)  

Hadley Wickham (2011)  
[The split-apply-combine strategy for data analysis](https://doi.org/10.18637/jss.v040.i01) 
]

---

.f2.code[.b.blue[`dplyr::`].red.b[`group_by()`]]

.f4[
- Define groups with one or more variables  
- Stratify a data frame 
- equivalent to `aggregate()` and the '`by = `' argument in .b[`data.table`]
]

.center[
&lt;img align="middle" src="imgs/groupby.PNG" width="67%" /&gt;    
]
from: Manipulación de datos en R con dplyr - Rubén Sánchez"

---

## Aggregating or manipulating grouped data

.f3[
Once `group_by()` creates a "grouped" version of a table, `dplyr` functions will manipulate each "group" separately and then combine the results. 
]

.bottom[
.tr[
RStudio (2021)  
[Data transformation with dplyr cheatsheet](
https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-transformation.pdf)
]
]

---

### Within groups, we can:

.f3[
- summarize group values (mean, median)

- extract the first or last _n_ rows from each group

- find the minimum or maximum values

- remove duplicated rows

- count records, etc.]

---


```r
head(msleep)
```

<div id="nmressaldj" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#nmressaldj .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#nmressaldj .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nmressaldj .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#nmressaldj .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#nmressaldj .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nmressaldj .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nmressaldj .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#nmressaldj .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#nmressaldj .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#nmressaldj .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#nmressaldj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#nmressaldj .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#nmressaldj .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#nmressaldj .gt_from_md > :first-child {
  margin-top: 0;
}

#nmressaldj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#nmressaldj .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#nmressaldj .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#nmressaldj .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nmressaldj .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#nmressaldj .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nmressaldj .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#nmressaldj .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#nmressaldj .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nmressaldj .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nmressaldj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#nmressaldj .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nmressaldj .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#nmressaldj .gt_left {
  text-align: left;
}

#nmressaldj .gt_center {
  text-align: center;
}

#nmressaldj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#nmressaldj .gt_font_normal {
  font-weight: normal;
}

#nmressaldj .gt_font_bold {
  font-weight: bold;
}

#nmressaldj .gt_font_italic {
  font-style: italic;
}

#nmressaldj .gt_super {
  font-size: 65%;
}

#nmressaldj .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 21px;">name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 21px;">genus</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 21px;">vore</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 21px;">order</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="font-size: 21px;">conservation</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="font-size: 21px;">sleep_total</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="font-size: 21px;">sleep_rem</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="font-size: 21px;">sleep_cycle</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="font-size: 21px;">awake</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="font-size: 21px;">brainwt</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="font-size: 21px;">bodywt</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left" style="font-size: 21px;">Cheetah</td>
<td class="gt_row gt_left" style="font-size: 21px;">Acinonyx</td>
<td class="gt_row gt_left" style="font-size: 21px;">carni</td>
<td class="gt_row gt_left" style="font-size: 21px;">Carnivora</td>
<td class="gt_row gt_left" style="font-size: 21px;">lc</td>
<td class="gt_row gt_right" style="font-size: 21px;">12.1</td>
<td class="gt_row gt_right" style="font-size: 21px;">NA</td>
<td class="gt_row gt_right" style="font-size: 21px;">NA</td>
<td class="gt_row gt_right" style="font-size: 21px;">11.9</td>
<td class="gt_row gt_right" style="font-size: 21px;">NA</td>
<td class="gt_row gt_right" style="font-size: 21px;">50.000</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 21px;">Owl monkey</td>
<td class="gt_row gt_left" style="font-size: 21px;">Aotus</td>
<td class="gt_row gt_left" style="font-size: 21px;">omni</td>
<td class="gt_row gt_left" style="font-size: 21px;">Primates</td>
<td class="gt_row gt_left" style="font-size: 21px;">NA</td>
<td class="gt_row gt_right" style="font-size: 21px;">17.0</td>
<td class="gt_row gt_right" style="font-size: 21px;">1.8</td>
<td class="gt_row gt_right" style="font-size: 21px;">NA</td>
<td class="gt_row gt_right" style="font-size: 21px;">7.0</td>
<td class="gt_row gt_right" style="font-size: 21px;">0.01550</td>
<td class="gt_row gt_right" style="font-size: 21px;">0.480</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 21px;">Mountain beaver</td>
<td class="gt_row gt_left" style="font-size: 21px;">Aplodontia</td>
<td class="gt_row gt_left" style="font-size: 21px;">herbi</td>
<td class="gt_row gt_left" style="font-size: 21px;">Rodentia</td>
<td class="gt_row gt_left" style="font-size: 21px;">nt</td>
<td class="gt_row gt_right" style="font-size: 21px;">14.4</td>
<td class="gt_row gt_right" style="font-size: 21px;">2.4</td>
<td class="gt_row gt_right" style="font-size: 21px;">NA</td>
<td class="gt_row gt_right" style="font-size: 21px;">9.6</td>
<td class="gt_row gt_right" style="font-size: 21px;">NA</td>
<td class="gt_row gt_right" style="font-size: 21px;">1.350</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 21px;">Greater short-tailed shrew</td>
<td class="gt_row gt_left" style="font-size: 21px;">Blarina</td>
<td class="gt_row gt_left" style="font-size: 21px;">omni</td>
<td class="gt_row gt_left" style="font-size: 21px;">Soricomorpha</td>
<td class="gt_row gt_left" style="font-size: 21px;">lc</td>
<td class="gt_row gt_right" style="font-size: 21px;">14.9</td>
<td class="gt_row gt_right" style="font-size: 21px;">2.3</td>
<td class="gt_row gt_right" style="font-size: 21px;">0.1333333</td>
<td class="gt_row gt_right" style="font-size: 21px;">9.1</td>
<td class="gt_row gt_right" style="font-size: 21px;">0.00029</td>
<td class="gt_row gt_right" style="font-size: 21px;">0.019</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 21px;">Cow</td>
<td class="gt_row gt_left" style="font-size: 21px;">Bos</td>
<td class="gt_row gt_left" style="font-size: 21px;">herbi</td>
<td class="gt_row gt_left" style="font-size: 21px;">Artiodactyla</td>
<td class="gt_row gt_left" style="font-size: 21px;">domesticated</td>
<td class="gt_row gt_right" style="font-size: 21px;">4.0</td>
<td class="gt_row gt_right" style="font-size: 21px;">0.7</td>
<td class="gt_row gt_right" style="font-size: 21px;">0.6666667</td>
<td class="gt_row gt_right" style="font-size: 21px;">20.0</td>
<td class="gt_row gt_right" style="font-size: 21px;">0.42300</td>
<td class="gt_row gt_right" style="font-size: 21px;">600.000</td></tr>
    <tr><td class="gt_row gt_left" style="font-size: 21px;">Three-toed sloth</td>
<td class="gt_row gt_left" style="font-size: 21px;">Bradypus</td>
<td class="gt_row gt_left" style="font-size: 21px;">herbi</td>
<td class="gt_row gt_left" style="font-size: 21px;">Pilosa</td>
<td class="gt_row gt_left" style="font-size: 21px;">NA</td>
<td class="gt_row gt_right" style="font-size: 21px;">14.4</td>
<td class="gt_row gt_right" style="font-size: 21px;">2.2</td>
<td class="gt_row gt_right" style="font-size: 21px;">0.7666667</td>
<td class="gt_row gt_right" style="font-size: 21px;">9.6</td>
<td class="gt_row gt_right" style="font-size: 21px;">NA</td>
<td class="gt_row gt_right" style="font-size: 21px;">3.850</td></tr>
  </tbody>
  
  
</table>
</div>

---

### maximum `brainwt` for each order


```r
msleep %&gt;% group_by(order) %&gt;% slice_max(brainwt,n=1)
```

.tinycode[

```
## # A tibble: 17 × 11
## # Groups:   order [17]
##    name       genus   vore  order   conservation sleep_total sleep_rem
##    &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;
##  1 Tenrec     Tenrec  omni  Afroso… &lt;NA&gt;                15.6       2.3
##  2 Cow        Bos     herbi Artiod… domesticated         4         0.7
##  3 Gray seal  Halioc… carni Carniv… lc                   6.2       1.5
##  4 Big brown… Eptesi… inse… Chirop… lc                  19.7       3.9
##  5 Giant arm… Priodo… inse… Cingul… en                  18.1       6.1
##  6 North Ame… Didelp… omni  Didelp… lc                  18         4.9
##  7 Phalanger  Phalan… &lt;NA&gt;  Diprot… &lt;NA&gt;                13.7       1.8
##  8 European … Erinac… omni  Erinac… lc                  10.1       3.5
##  9 Rock hyrax Procav… &lt;NA&gt;  Hyraco… lc                   5.4       0.5
## 10 Rabbit     Orycto… herbi Lagomo… domesticated         8.4       0.9
## 11 Short-nos… Tachyg… inse… Monotr… &lt;NA&gt;                 8.6      NA  
## 12 Horse      Equus   herbi Periss… domesticated         2.9       0.6
## 13 Human      Homo    omni  Primat… &lt;NA&gt;                 8         1.9
## 14 African e… Loxodo… herbi Probos… vu                   3.3      NA  
## 15 African g… Cricet… omni  Rodent… &lt;NA&gt;                 8.3       2  
## 16 Tree shrew Tupaia  omni  Scande… &lt;NA&gt;                 8.9       2.6
## 17 Eastern a… Scalop… inse… Sorico… lc                   8.4       2.1
## # … with 4 more variables: sleep_cycle &lt;dbl&gt;, awake &lt;dbl&gt;,
## #   brainwt &lt;dbl&gt;, bodywt &lt;dbl&gt;
```
]

---

### one row sampled randomly from each order

```r
msleep %&gt;% group_by(order) %&gt;% slice_sample(n=1)
```

.tinycode[

```
## # A tibble: 19 × 11
## # Groups:   order [19]
##    name       genus   vore  order   conservation sleep_total sleep_rem
##    &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;
##  1 Tenrec     Tenrec  omni  Afroso… &lt;NA&gt;                15.6       2.3
##  2 Cow        Bos     herbi Artiod… domesticated         4         0.7
##  3 Domestic … Felis   carni Carniv… domesticated        12.5       3.2
##  4 Bottle-no… Tursio… carni Cetacea &lt;NA&gt;                 5.2      NA  
##  5 Little br… Myotis  inse… Chirop… &lt;NA&gt;                19.9       2  
##  6 Giant arm… Priodo… inse… Cingul… en                  18.1       6.1
##  7 North Ame… Didelp… omni  Didelp… lc                  18         4.9
##  8 Phalanger  Phalan… &lt;NA&gt;  Diprot… &lt;NA&gt;                13.7       1.8
##  9 Desert he… Paraec… &lt;NA&gt;  Erinac… lc                  10.3       2.7
## 10 Gray hyrax Hetero… herbi Hyraco… lc                   6.3       0.6
## 11 Rabbit     Orycto… herbi Lagomo… domesticated         8.4       0.9
## 12 Short-nos… Tachyg… inse… Monotr… &lt;NA&gt;                 8.6      NA  
## 13 Brazilian… Tapirus herbi Periss… vu                   4.4       1  
## 14 Three-toe… Bradyp… herbi Pilosa  &lt;NA&gt;                14.4       2.2
## 15 Mongoose … Lemur   herbi Primat… vu                   9.5       0.9
## 16 Asian ele… Elephas herbi Probos… en                   3.9      NA  
## 17 African g… Cricet… omni  Rodent… &lt;NA&gt;                 8.3       2  
## 18 Tree shrew Tupaia  omni  Scande… &lt;NA&gt;                 8.9       2.6
## 19 Eastern a… Scalop… inse… Sorico… lc                   8.4       2.1
## # … with 4 more variables: sleep_cycle &lt;dbl&gt;, awake &lt;dbl&gt;,
## #   brainwt &lt;dbl&gt;, bodywt &lt;dbl&gt;
```
]

---
.f3.b.blue[summarize]

```r
msleep %&gt;% group_by(order) %&gt;% 
  summarize(mean_slp = mean(sleep_total),
            mean_brainwt=mean(brainwt))
```
.center[
.tinycode[

```
## # A tibble: 19 × 3
##    order           mean_slp mean_brainwt
##    &lt;chr&gt;              &lt;dbl&gt;        &lt;dbl&gt;
##  1 Afrosoricida       15.6      0.0026  
##  2 Artiodactyla        4.52    NA       
##  3 Carnivora          10.1     NA       
##  4 Cetacea             4.5     NA       
##  5 Chiroptera         19.8      0.000275
##  6 Cingulata          17.8      0.0459  
##  7 Didelphimorphia    18.7     NA       
##  8 Diprotodontia      12.4     NA       
##  9 Erinaceomorpha     10.2      0.00295 
## 10 Hyracoidea          5.67     0.0152  
## 11 Lagomorpha          8.4      0.0121  
## 12 Monotremata         8.6      0.025   
## 13 Perissodactyla      3.47     0.414   
## 14 Pilosa             14.4     NA       
## 15 Primates           10.5     NA       
## 16 Proboscidea         3.6      5.16    
## 17 Rodentia           12.5     NA       
## 18 Scandentia          8.9      0.0025  
## 19 Soricomorpha       11.1      0.000592
```
]
]
---

# Loops are fine

.f3[(and most of the time you don't have to write them yourselves anyway)]

.left-column[
&lt;img align="middle" src="imgs/loops.png" width="100%" /&gt;   
]

.tr[
Jenny Bryan  
[purrr tutorial](https://jennybc.github.io/purrr-tutorial/index.html)  
[Data Rectangling](https://speakerdeck.com/jennybc/data-rectangling)  
[purrr workshop](https://speakerdeck.com/jennybc/purrr-workshop)
]

---

## For loops

.pull-left[

```r
for (value in sequence) {
   statement(s)
}
```

 
Execute a set of _statements_, once for each item in a vector, array, list, etc. and stop when the last element is reached. 
]

.pull-right[

```r
for (x in 1:7) {
  print(x)
} 
```

```
## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7
```
]

---

## Loops and working with groups


```r
msleep %&gt;% 
  group_by(order) %&gt;%   # for order in orders
  slice_sample(1)       # statement to execute 
                        ## (sample element at random)
```

.f3[Similar to loops but we keep everything inside the data frame]

---

# Vectorization is our friend

Operations occur in parallel on all elements, rather than on individual components in sequence

.f3[What will be the result here?]


```r
x &lt;- c(1,3,12,4,7,8)
x &gt; 5
```

---

### Logical operators are vectorized (many other fns too!)


```r
x &lt;- c(1,3,12,4,7,8)
x &gt; 5
```

```
## [1] FALSE FALSE  TRUE FALSE  TRUE  TRUE
```

We don't need to type all of this out or a loop

```r
x[1]&gt;5 ; x[2]&gt;5
x[3]&gt;5 ; x[4]&gt;5
x[5]&gt;5 ; x[6]&gt;5
```

---

.center[
&lt;img src="imgs/dogscopy.jpg" width="36%" /&gt;   
]
.center.f4[American Greetings]
---

# If we really need to iterate
.left-column[
&lt;img src="imgs/purrr.jpeg" width="90%" style="display: block; margin: auto;" /&gt;
]

.right-column[
.f3[
📦 **`purrr`** - Functional programming tools

- map functions to data  
- work efficiently with **lists**
- readable code
]
]

.tr[
Thomas Mock (2018)  
[Functional Programming in R with purrr](https://towardsdatascience.com/functional-programming-in-r-with-purrr-469e597d0229)
]

---

class: middle

.f1.code.center[
map(.red.b[.x], .green.b[.f], ...)
]

.f2[for every element of .red.b.code[.x]

apply .b.green.code[.f]

...  arguments for .green.b.code[.f]
]


---

## Mapping functions to data
.center[`map(.x,.f)`]

.f2[We can specify .green.b.code[.f] as:]

.f3[
- an existing function  

- an anonymous function, defined on-the-fly

- a formula: unique to `purrr`,  provides a very concise way to define anonymous functions
]

---

## Functions

&lt;img src="imgs/r-function-syntax.png" width="80%" style="display: block; margin: auto;" /&gt;
https://www.learnbyexample.org/r-functions/

---

.b.blue.f2[Function Definition] - The '`function()`' function

.f2.center[`function( arglist ) expr`]

.f3[
**arguments** (`arglist`): values passed to the function

**expression** `(expr)`: 
an object that represents an action that can be performed by R. .b[Expressions contain one or more statements]
]

---

## Defining a function 


```r
my_custom_function &lt;- function(my_arg){
  x+1 # statement
}

my_vector &lt;- c(3,5,6,7)

my_custom_function(my_arg = my_vector)
```

```
## [1]  2  4 13  5  8  9
```


---

.f3[The body of the function –the statements that are executed when it runs– is grouped with curly braces   (`{}`)]


```r
f &lt;- function(x) {
  x + 4 # statement
}
```

.left-column[
.smallercode[

```r
f(6)
```

```
## [1] 10
```

```r
f(x=6)
```

```
## [1] 10
```
]]

.right-column[
Writing the names of arguments in a function call is optional, but for functions with &gt;1 arguments the order of the argument values matters]

---

.f3[**But** we _don't_ need curly braces for functions with only one statement]


```r
f &lt;- function(x) x+4   
f(x=6)
```

```
## [1] 10
```


```r
f &lt;- function(x) mean(x)/2   
f(c(6,43,12,5,7))
```

```
## [1] 7.3
```

---

.f3[Enclose multi-statement function bodies in curly braces]

```r
f &lt;- function(x)  y &lt;- (x*0.2885) log(y) # WON'T RUN  
```

.f3[Works, note the statements in separate lines]

```r
f &lt;- function(x) {
  y &lt;- (x*0.2885) # this is a statement
  log(y)          # this is another statement
}

f(5)
```

```
## [1] 0.3663777
```

---

## Anonymous functions

.f3[Functions on the go
(created and used but never assigned to a variable)]

### Anonymous function syntax

```r
(function(x) x * x + 3)(10)
```

```
## [1] 103
```

the function definition in anonymous functions needs to be wrapped in parentheses to separate function and arguments

---


```r
(function(x) x + 3)(10)
```

Behaves exactly the same as


```r
f &lt;- function(x) x + 3
f(10)
```

```
## [1] 13
```

```r
# or 
f &lt;- function(x) {x + 3}
f(10)
```

```
## [1] 13
```

---

## Anonymous functions

.f3[
- Handy when we want to apply a user-defined operation to many things at once

- Also known as _lambda expressions_

- Self-contained

- Comparable with similar approaches in Python
]

---

## Why write our own functions

.f3[
- Avoids repetition

- Brevity

- Less room for errors

- Take advantage of tools that help us apply functions to many things at once
]

.tr[
Jenny Bryan - Stat545  
[Write your own R functions](https://stat545.com/functions-part1.html)
]

---

# Lists

.f3[Objects which contain elements of different types, such as numbers, strings, vectors, data frames, or even other lists]


```r
my_list &lt;- list(
  a_number = 7,
  a_vector = c("mouse", "cat", "dog"),
  a_dataframe = data.frame(
    a = 1:3, b = c("K", "L", "M")))
```

.tr[
Rebecca Barter (2019)  
[Learn to purrr](https://www.rebeccabarter.com/blog/2019-08-19_purrr/)
]

---


```r
my_list
```

```
## $a_number
## [1] 7
## 
## $a_vector
## [1] "mouse" "cat"   "dog"  
## 
## $a_dataframe
##   a b
## 1 1 K
## 2 2 L
## 3 3 M
```

---

## List indexing
.center[
&lt;img src="imgs/listspepper.png" width="76%" /&gt;   
]
Hadley Wickam (2015) on [Twitter](https://twitter.com/hadleywickham/status/643381054758363136?s=20&amp;t=0Gu4Qs757o5KHEJR2ZwkEg)

---

.f3[We can also create lists by splitting other objects]

Group and split with `dplyr` into a list of data frames, one for each group


```r
cars_country &lt;- 
  gt::gtcars %&gt;% group_by(ctry_origin) %&gt;%
  group_split()
```




```r
class(cars_country)
```

```
## [1] "vctrs_list_of" "vctrs_vctr"    "list"
```

---

.f3[`group_keys()` retrieves the grouping data]


```r
gt::gtcars %&gt;% group_by(ctry_origin) %&gt;%
  group_keys()
```

```
## # A tibble: 5 × 1
##   ctry_origin   
##   &lt;chr&gt;         
## 1 Germany       
## 2 Italy         
## 3 Japan         
## 4 United Kingdom
## 5 United States
```

---


```r
cars_country[[1]] %&gt;% 
  select(model,ctry_origin) %&gt;% head
```

```
## # A tibble: 6 × 2
##   model    ctry_origin
##   &lt;chr&gt;    &lt;chr&gt;      
## 1 6-Series Germany    
## 2 i8       Germany    
## 3 M4       Germany    
## 4 M5       Germany    
## 5 M6       Germany    
## 6 R8       Germany
```

---


```r
cars_country[[2]] %&gt;% 
  select(model,ctry_origin, hp, msrp) %&gt;% 
  head
```

```
## # A tibble: 6 × 4
##   model        ctry_origin    hp   msrp
##   &lt;chr&gt;        &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;
## 1 458 Speciale Italy         597 291744
## 2 458 Spider   Italy         562 263553
## 3 458 Italia   Italy         562 233509
## 4 488 GTB      Italy         661 245400
## 5 California   Italy         553 198973
## 6 GTC4Lusso    Italy         680 298000
```

---

.center[
&lt;img src="imgs/purrrPost.png" /&gt;   
]
Luis (2017)
Export Iteratively  
https://luisdva.github.io/rstats/export-iteratively/

---

# Why lists?

- Flexible, can store many kinds of objects

- We can easily create lists by splitting existing objects

- List elements can be named 

---

## Mapping functions to data 

- Apply functions to many things at once

- Reading many files at once

- Modifying and exporting multiple objects

---

### Apply functions to many things at once

```r
library(openintro)
library(purrr)
data("starbucks")
# create three vectors (numeric)
fat &lt;- starbucks$fat
carb &lt;- starbucks$carb
protein &lt;- starbucks$protein
# put them in a list
nutrients &lt;- list(fat,carb,protein)
# apply the mean function to each list element
map(nutrients,mean)
```

---

### Apply (custom) functions to many things at once 


```r
# fn that gets min, max, and range

getMinMaxRange &lt;- function(x){
  min_x &lt;- min(x)
  max_x &lt;- max(x)
  maxmin &lt;- max_x - min_x
  c(min_x, max_x, maxmin)
}
```

---

### Check that the function works for vectors




```r
getMinMaxRange(protein)
```

```
## [1]  0 34 34
```

```r
getMinMaxRange(carb)
```

```
## [1] 16 80 64
```

```r
getMinMaxRange(fat)
```

```
## [1]  0 28 28
```


---

### Use `map()` to apply the fn to all the list elements


```r
map(.x = nutrients, .f = getMinMaxRange)
```

```
## [[1]]
## [1]  0 28 28
## 
## [[2]]
## [1] 16 80 64
## 
## [[3]]
## [1]  0 34 34
```

---

## Type-specific `map()` 
.f3[
`map()` always returns lists  

`map_lgl()` returns a logical  

`map_int()` returns an integer vector  

`map_dbl()` returns a double vector

`map_chr()` returns a character vector

`map_df()` returns a data frame
]

---


```r
map(nutrients, median)
```

```
## [[1]]
## [1] 13
## 
## [[2]]
## [1] 45
## 
## [[3]]
## [1] 7
```

```r
map_dbl(nutrients, median)
```

```
## [1] 13 45  7
```
---

## What about anonymous functions and formulas?

.f3[Once we know how to define new functions, we can write anonymous functions to express what we want to do if we only need to do it once.]



.tr[Anonymous Functions in R - Part 1  
https://coolbutuseless.github.io/2019/03/13/anonymous-functions-in-r-part-1/]

---

## Anonymous functions and formulas

Same behavior

```r
numlist &lt;- list(c(5:10),c(20:27))
# anonymous function
map(numlist, function(x) x+2)
# formula notation
map(numlist, ~ .x + 2)
```

---

.f2[In formula shorthand notation (defined with `~`) 
.b.code.red[.x] always refers to the element of the vector or list we are iterating on]

.f2[Behind the scenes .b.red[`~.x + 4`] becomes .b.red[`function(x) x+4`]]

---

# Reading or writing many files at once

.center.f2[`map(.x,.f)`]

.f2.red.b[`.x`] .f2[can be a list or vector of file paths]

.f2.green.b[`.f`] .f2[can be a function that reads or writes files]


---

class: inverse

### Let's create a directory full of text files

.f3.white[
- load `openintro` and make the `nba_players_19` data available

- group the data by `team` then use `group_split()` to create a list of data frames, one for each team

- create a vector of team names
]

&gt; 😲 We can iterate over two inputs simultaneously

---

# Mapping w/ two inputs

.center.f2[`map2(.x, .y., .f)`]

.f3[Both input lists or vectors are passed to function .b[.f]]

.pull-left[
&lt;img align="middle" src="imgs/map2.png" width="87%" /&gt;    
]
.pull-right[
Altman et al. (2021)  
[Map with multiple inputs](https://dcl-prog.stanford.edu/purrr-parallel.html)
 ]
 
---

class: inverse
## Creating a directory full of text files

.f3.white[
- Create the folder "nbateams" inside your "Data" folder

- Use `here()` to build file (safe and portable) paths for each team in the vector of team names

- Feed the list of data frames and the vector of file paths to `readr::write_csv`
 ]

.center[🔥🏀🔥]

---
class: inverse
## Reading many files at once

.f3.white[
- use `dir_ls()` to create a vector with the paths for your newly created csv files

- read each element of this vector with `map()` and `readr::read_csv()`

- BONUS CHALLENGE: type-specific mapping (putting everything into a data frame) will throw an error here. Why?
]


---
class: dk-section-title
background-image:url("imgs/peru.jpg")
background-size: cover

# Regular expressions and working with strings

---

# What are Regular Expressions?

- Also abbreviated as regex, R.E., or regexp (singular)  

- A concise language for describing patterns of text 

## Specially encoded 🧶.helvetica[_strings_] of characters that match patterns in other text strings 


---

## Regular expressions

.f3[
In practice, a computer language with its own terminologies and syntax

- Input as a text string that compiles into a mini program built specifically to identify a pattern. 

- Can be used to match, search, replace, or split text 
]
---

## 🧶Strings

.f3[
A collection of characters that make up one element of a vector:
]


```r
test_string &lt;- "This sentence is a string."
```




.f3[
We can store multiple strings in a character vector:
]


```r
pets &lt;-  c("dogs","cat","parrot","pig")
```



---

## Strings

.pull-left[
.f3[Headers and values in a data frame can also be strings:]]



.pull-right[
<div id="eeyhoummza" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#eeyhoummza .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#eeyhoummza .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#eeyhoummza .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#eeyhoummza .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#eeyhoummza .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#eeyhoummza .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#eeyhoummza .gt_col_heading {
  color: #333333;
  background-color: #FFFF00;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#eeyhoummza .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFF00;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#eeyhoummza .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#eeyhoummza .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#eeyhoummza .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#eeyhoummza .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#eeyhoummza .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#eeyhoummza .gt_from_md > :first-child {
  margin-top: 0;
}

#eeyhoummza .gt_from_md > :last-child {
  margin-bottom: 0;
}

#eeyhoummza .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#eeyhoummza .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#eeyhoummza .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#eeyhoummza .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#eeyhoummza .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#eeyhoummza .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#eeyhoummza .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#eeyhoummza .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#eeyhoummza .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#eeyhoummza .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#eeyhoummza .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#eeyhoummza .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#eeyhoummza .gt_left {
  text-align: left;
}

#eeyhoummza .gt_center {
  text-align: center;
}

#eeyhoummza .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#eeyhoummza .gt_font_normal {
  font-weight: normal;
}

#eeyhoummza .gt_font_bold {
  font-weight: bold;
}

#eeyhoummza .gt_font_italic {
  font-style: italic;
}

#eeyhoummza .gt_super {
  font-size: 65%;
}

#eeyhoummza .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">drink</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">price</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left" style="background-color: #FFFF00;">Coffee</td>
<td class="gt_row gt_right">3.50</td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #FFFF00;">Tea</td>
<td class="gt_row gt_right">2.99</td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #FFFF00;">Juice</td>
<td class="gt_row gt_right">3.20</td></tr>
  </tbody>
  
  
</table>
</div>
]


&lt;br/&gt;
&gt; Remember how we matched patterns in column names when working with `select()` and the `matches()` selection helper

---

## Strings in R are _case sensitive_

Uppercase and lowercase letters are treated as distinct



```r
"rat"=="rat"
```

```
## [1] TRUE
```




```r
"rat"=="rAT"
```

```
## [1] FALSE
```


---

### Regex searches are case sensitive by default

Our options:   

.f3[
- Build case-insensitive regular expressions  

- Turn off case sensitivity in the matching, 

- Modify the input text before matching. 
]

---
## Why Learn Regular Expressions?

.f3[
- Writing regular expressions &lt;- underutilized, valuable skill 

- Save  time when we need to match, extract, or transform text by matching words, characters, and patterns

- Regular expressions can often **replace dozens of lines of code**

- Not specific to any particular programming language or command-line tool
]

---

## Getting started

.fl.w-third[
&lt;div class="f2 mt1 pt0 code"&gt;Regexp&lt;/div&gt;
&lt;/br&gt;
]

.fl.w-third[
&lt;div class="f2 mt0 pt0 code"&gt;Input string&lt;/div&gt;
&lt;/br&gt;
]

.fl.w-third[
&lt;div class="f2 mt0 pt0 code"&gt;Match&lt;/div&gt;
&lt;/br&gt;
]
&lt;/br&gt;

&lt;/br&gt;&lt;/br&gt;



The matching is done by the regex engine. We do not access the engine directly, but functions that take regular expressions as arguments call on it whenever its needed.

---

## Getting started


.fl.w-third[
&lt;div class="f2 mt1 pt0 code"&gt;Regexp&lt;/div&gt;
&lt;/br&gt;
`dog`
]

.fl.w-third[
&lt;div class="f2 mt0 pt0 code"&gt;Input string&lt;/div&gt;
&lt;/br&gt;
"The dog is fat."
]

.fl.w-third[
&lt;div class="f2 mt0 pt0 code"&gt;Match&lt;/div&gt;
&lt;/br&gt;
The .bg-yellow[dog] is fat.

]
&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;
.f3[
To search for a specific sequence of characters, the regexp (regular expression) we need is simply that sequence of characters]


&gt; find a **d** followed by an **o** followed by a g. (all characters together and in that order when read from left to right)

---

## Online regex testers
.f3[Is the regular expression matching anything?]


- [rubular](https://rubular.com/) by Michael Lovitt  

- [regex101](https://regex101.com/) by Firas Dib 

- [regexr](https://regexr.com/) by Grant Skinner 

- [regexpal](https://www.regexpal.com/) - part of Dan's Developer Tools 

---

## Regex Testers

&lt;img src="imgs/regextester.png" width="100%" style="display: block; margin: auto auto auto 0;" /&gt;


---

class: inverse
## Practice

.f3.white[Navigate to [rubular](https://rubular.com/), [regex101](https://regex101.com/), [regexr](https://regexr.com/), or [regexpal](https://www.regexpal.com/)

Input the following text into the test string field: 
]

milk  
rice   
cereal  
salt  
soda  

.f3.white[Write regular expressions (one at a time) to match the things we can drink and look at the match results]


---

## Literal Characters and Metacharacters

.f2[
Strings and regular expressions are made of characters

For regular expressions, characters can be grouped into two classes depending on their behavior
]

---

## Literal characters

.f2[
If input string is **"dog"** and regex is .b.orange[dog]

We will get a match whenever the characters .orange[`d`], .orange[`o`], and .orange[`g`] occur consecutively in the input text]

--

`"dog"` tells the regex engine:
find a .orange[d], immediately followed by an .orange[o], immediately followed by a .orange[g] (.b[together and in that particular order])

---

## Literal characters (continued)

.f3[.orange[`d`], .orange[`o`], and .orange[`g`] are examples of literal characters]. 


.f2[They stand for exactly what they are: .orange[`d`] in the regex matches a “.purple.b[d]” in the input text, .orange[`o`]  matches an “.purple.b[o]” in text, and so on.]

---
class: middle

.f2[The power and flexibility of regular expressions comes from their ability to describe more complex patterns.


If a text pattern can be described verbally, we can most likely write regular expression to match it.]


---

### Possible patterns


- "dog" but not "dogs"  


- "dogs" but only if the match is at the start of the string,

- digits (0, 1, 2, 3, 4, 5, 6, 7, 8,  9)  


- "modeling" or "modelling"  (alternate spellings of the same word)


- words ending in "at" (words that begin or end with a specific pattern)

- strings that start with digits

- dates

---

### Possible patterns

- zip codes

- numbers inside square brackets and also the brackets  

- valid Twitter handles (start with @, no spaces or symbols, &lt;16 characters)

- UPPERCASE words

---

## Metacharacters

.f3[To match more than literal strings of text, a small subset of characters that have special functionalities when they appear in a regular expression. Metacharacters do not stand for themselves, they interpreted in a special way.]

.f3[ 
Metacharacters include: .b.orange[[]\^$.|?*+()], which are reserved for unique matching purposes.
]



---

.f3[
.b[Wildcards] stand in for unknown characters  
]


&amp;nbsp; .f1.orange.pre[&amp;nbsp;.&amp;nbsp; ] &amp;nbsp;&amp;nbsp; match any character once
***


.b.orange[f..l] matches ".b.bg-yellow[fill]" and ".b.bg-yellow[fool]", but not "flail"  


.b.orange[.top] matches ".b.bg-yellow[stop]" and "is.b.bg-yellow[otop]e", but not "topple"  


&gt; note the substring match in "is**otop**e" 

---

.f3[
.b[Character sets] match one or more characters enclosed in square brackets 
]

&amp;nbsp;.b.orange.pre[&amp;nbsp;[ ] &amp;nbsp;] &amp;nbsp;&amp;nbsp; match a set of characters  
***

.b.orange[[cb]at] matches ".b.bg-yellow[cat]", and ".b.bg-yellow[bat]", but not "rat"

.b.orange[[CK]at[iey]] matches ".b.bg-yellow[Caty]", ".b.bg-yellow[Kati]", ".b.bg-yellow[Katy]", and ".b.bg-yellow[Kate]"

---

.f3[
.b[Negation tokens]&amp;nbsp;  
  
.orange.b[[^]] 	&amp;nbsp;&amp;nbsp; match characters not in the specified character set]

&gt; `^` must be the first character inside the brackets

***


.b.orange[[^aoeiou]] matches consonants


.b.orange[[^R]] matches everything except capital R

---

.f3[
.b[Character ranges] indicate a series of sequential characters inside character sets 
]

Dash (.b.orange[\-]) inside a character set abbreviates alphabetical or numeric sequences 
***


.b.orange[[A-D]]  matches any single letter from A,B,C, or D (uppercase)


.b.orange[[5-8]]  &amp;nbsp;matches any single digit between 5 and 8  

.b.orange[[A-Za-z]]  matches all alphabetical characters


&gt; Character sets are case sensitive


&gt; character ranges can also be negated with `^`

---

.f3[
.b[Anchors] specify the relative position of the pattern being matched   
]


&amp;nbsp;.orange.f3.pre[&amp;nbsp;^&amp;nbsp;] &amp;nbsp;&amp;nbsp;     starts with  
&amp;nbsp;.f3.orange.pre[&amp;nbsp;$&amp;nbsp;]  &amp;nbsp;&amp;nbsp; ends with  
.b.orange[`^`] outside a pair of square brackets is an anchor
***



.b.orange[^mil] matches ".b.bg-yellow[mil]kshake" but not "family"  

.b.orange[ing$] matches "go.b.bg-yellow[ing]" but not "ingest"  

&gt; note the substring matches

---

class: inverse

### Practice
.f3.white[
- Write a regexp that can match **tail**, **tool**, **tall**, and **toil**  

- How can we match **Jocelyn**, **Jocelin**, and **Joselyn** but not Jozelyn using character sets?

.fl.w-third.pa0[.tc[
a) Joscel[iy]n
]]
.fl.w-third.pa0[.tc[
b) Jo[sc^z]el[yi]n
]]
.fl.w-third.pa0[.tc[
c) Jo[sc]el[yi]n
]]
]

---

class: inverse

.f3.white[
- Which of these regular expressions matches **`food`** at the beginning of a string?


.fl.w-25[.tl[
a) ^food
]]
.fl.w-25[.tl[
b) food
]]
.fl.w-25[.tl[
c) $food
]]
.fl.w-25[.tl[
d) food^
]]
]

---

.f3[**Quantifiers** specify how many times a character or character class must appear in the input for a match to be found]

&amp;nbsp;.f2[.orange.f1[&amp;nbsp;?&amp;nbsp;] &amp;nbsp;&amp;nbsp;Zero or one ]  	
&amp;nbsp;.f2[.orange.f1[&amp;nbsp;\\\*&amp;nbsp;] &amp;nbsp;&amp;nbsp;Zero or more occurrences] 	
&amp;nbsp;.f2[.orange.f1[&amp;nbsp;+&amp;nbsp;]	 &amp;nbsp;&amp;nbsp;One or more occurrences]   
&amp;nbsp;.f2[.orange.f1[&amp;nbsp;{}] 	&amp;nbsp;&amp;nbsp;Exactly the specified number of occurrences]  	

&gt; quantifiers apply to the preceding character

---

### Quantifiers


.b.orange[modell?ing] matches ".b.bg-yellow[modeling]" and ".b.bg-yellow[modelling]"  

&gt; zero or one `els (l)`


.b.orange[ya*y!] matches ".b.bg-yellow[yy!]", ".b.bg-yellow[yay!]", ".b.bg-yellow[yaaay!]", ".b.bg-yellow[yaaaaaay!]", etc.

&gt; zero or more `aes (a)`

---

### Quantifiers

.b.orange[no+] matches “.bg-yellow.b[no]”, “.bg-yellow.b[nooo]", ".bg-yellow.b[noooooo]", etc, but not “n”  

&gt; one or more `oes (o)`


.b.orange[e{2}] matches .“k.b.purple.bg-yellow[ee]p” and “b.b.purple.bg-yellow[ee]" but not “meat” 

&gt; exactly two `ees (e)`


---
class: inverse
## Practice

.f3.white[
- Use a quantifier to match **cute**, **cuuute**, **cuuuuuute**, and **cuuuuuuuuute**  

- How can we match Computer, computer, Computers, and computers?

.fl.w-third.pa0[.tc[
a) [cC]omputers?
]]
.fl.w-third.pa0[.tc[
b) Computers+
]]
.fl.w-third.pa0[.tc[
c) [cC]omputer[s]+
]]

]
---

.f3[
.b[Alternation] tokens separate a series of alternatives]  
.f3[.orange.b.pre[&amp;nbsp;|&amp;nbsp;] &amp;nbsp;&amp;nbsp; either or
]
***


.b.orange[dog|bird] matches ".b.purple.bg-yellow[dog]" or ".b.purple.bg-yellow[bird]"

.b.orange[gr(a|e)y] matches ".b.purple.bg-yellow[gray]" and ".b.purple.bg-yellow[grey]"
&gt; note the alternation enclosed in brackets


---

.f3[
.b[Special sequences and escapes]&lt;br&gt;
.b.orange.pre[&amp;nbsp;\\&amp;nbsp;] 	&amp;nbsp;&amp;nbsp; signals a shorthand sequence or gives special characters a literal meaning
]

---

### Escapes
.b.orange[hello\\\\\\\\?] matches ".b.purple.bg-yellow[hello?]"

.f3[
&gt; question mark treated as a literal character, but in R escape the backslash first
]



_Metacharacters inside a character set are stripped of their special nature_

---

.f3[.b[Shorthand sequences] are available to refer to commonly-used character sets
]

.b.orange[\w] &amp;nbsp;letters, underscore, and numbers  &lt;br&gt;
.b.orange[\d] &amp;nbsp;digits&lt;br&gt;
.orange.b[\t]  &amp;nbsp;&amp;nbsp; tab &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; .orange.b[\n]  &amp;nbsp; new line &amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; .orange.b[\s]  &amp;nbsp;space&lt;br&gt;
.orange.b[\b]  &amp;nbsp;word boundary&lt;br&gt;

&gt;.small[Predefined character classes help us avoid malformed character sets]


---

### Word boundaries .b.orange[`\\b`]


Match **positions** between a _word_ character (letter, digit or underscore) and a non-word character (usually a space or the start/end of a string).
*** 

&gt; Before a sequence of word characters

.b.orange[\\bcase] matches ".b.bg-yellow.purple[case]" and "two .b.bg-yellow.purple[case]s" but not "suitcase"  

&gt; After a sequence of word characters

.b.orange[org\\b] matches "cyb.b.bg-yellow.purple[org] rebellion" but not "organic"


---

### _Word_ characters .b.orange[`\\w`]


Matches any character (letter, digit or underscore). Useful in combination with word boundaries and quantifiers.
***  


Equivalent to .orange[\[a-zA-Z0-9_\]]


.b.orange[\\w] matches letters (case insensitive), numbers, and underscores in:

.b.bg-yellow.purple[F33d].%.b.bg-yellow.purple[the_mÖusE] .b.bg-yellow.purple[pl]@.b.bg-yellow.purple[ase]!!# 


---

class: inverse
## Practice

.f3.white[
Enter "That athlete is at the squat rack" as the test string in a regex tester.

Explain the matches obtained with the following three regular expressions?
 
 a) at  
 b) \bat  
 c) at\b
]
---

## Anchor, wildcard with quantifier (0 or more)

.b.orange[^can.\\\*] matches ".b.purple.bg-yellow[can]", ".b.purple.bg-yellow[can]ine", ".b.purple.bg-yellow[can]oli", and ".b.purple.bg-yellow[can]adian"

##  Wildcard and quantifier
.b.orange[A.\\*x] strings that start with "**A**" and end with "**x**"

---

## Shorthand sequence (space) and quantifier

.b.orange[\\s{3}] matches three spaces 


## Anchors, character set, and quantifier (one or more) 

.b.orange[^[a-z]+$] matches a lowercase string


---

## Word characters, quantifiers, word boundaries, and anchors

.b.orange[\w+\b$] matches the last word in a string

"Fix the .b.purple.bg-yellow[car]."  
"12 .b.purple.bg-yellow[eggs]"

.b.orange[^\w+\b] matches the first word in a string

".b.purple.bg-yellow[Fix] the car."  
".b.purple.bg-yellow[12] eggs"


---

&lt;img src="imgs/regular-expressions.svg" width="66%" style="display: block; margin: auto;" /&gt;
&lt;/br&gt;
.center.small[Modified from '[Regular Expressions](https://github.com/rstudio/concept-maps/#regular-expressions)' concept map by Greg Wilson]

---
class: inverse
## Practice

.f3.white[
Write regular expressions to match the following, making sure they work in an interactive regex tester:

1. strings with both letters and digits
2. strings ending in a period
3. lowercase strings
4. exactly four digits
5. strings without the letter _**s**_
]

---
class: center, middle, dk-section-title
background-image:url("imgs/bsas.jpg")
background-size: cover
# Regex in R

---

.f3[
We can match column names and values in `character` strings with regular expressions]


&lt;img src="imgs/regexsubsetting.png" width="95%" style="display: block; margin: auto;" /&gt;

---

# 📦 .red[`stringr`]

.f3[
Cohesive set of functions for string manipulation
]



- Function names start with .b[`str_`]   

- All functions take a vector of strings as the first argument (pipe-friendly)  


**`regex()`** modifier to control matching behavior

.content-box-gray[`ignore_case=TRUE` will make matches case insensitive]


---

## `stringr` examples


**Matches?**


```r
str_detect(string = c("catalog", "battlecat", "apple"), pattern = "cat")
```

```
## [1]  TRUE  TRUE FALSE
```

Output is a logical, TRUE or FALSE vector of the same length as our input string

---

## `stringr` examples

**Which elements contain matches?**


```r
str_which(string = c("catalog", "battlecat", "apple"), pattern = "cat")
```

```
## [1] 1 2
```

Output is the index for each of the matching elements

---

## `stringr` examples

**Replacing matches**


```r
str_replace(string = c("colour", "neighbour", "honour"),
            pattern = "ou",
            replacement = "o")
```

```
## [1] "color"    "neighbor" "honor"
```


---

## `stringr` examples

**Case insensitive matching**


```r
str_replace(string = c("colOur", "neighboUr", "honOUr"),
            pattern = regex("ou", ignore_case = TRUE),   
            replacement = "o") 
```


---

## `stringr` examples

**Case insensitive matching**


```r
str_replace(string = c("colOur", "neighboUr", "honOUr"),
*           pattern = regex("ou", ignore_case = TRUE),
            replacement = "o") 
```


---

## `stringr` examples

**Case insensitive matching**


```r
str_replace(string = c("colOur", "neighboUr", "honOUr"),
*           pattern = regex("ou", ignore_case = TRUE),
            replacement = "o") 
```


```
## [1] "color"    "neighbor" "honor"
```


---

class: inverse

## Practice

.f3[
Match these REs against the test vector below using `str_detect`.  Can you explain the matches?

Regular expressions
1. ^dog
2. ^[a-z]+$
3. \\\\d
]


```r
test_vector &lt;- c("Those dogs are small.","dogs and cats",
                 "34","(34)","rat","watchdog","placemat",
                 "BABY","2011_April","mice")
```

---


---

## Using regular expressions in data manipulation



.f3[
Select, subset, keep, or discard rows and columns
]


.f3[   
Substitute or recode values
]


.f3[
Extract or remove substrings
]


---

## Cleaning data with regex

To select variables in 📦 .b.red[`dplyr`] and 📦 .b.red[`tidyr`], we:

- write out their names   

- refer to them by position  

- specify ranges of contiguous variables


- .f3[use 📦 .b.red[`tidyselect`] helper functions]

---

## 📦 .red.b[`tidyselect`] helpers


.b[`matches()`] takes regular expressions, and selects variables that match a given pattern



**`starts_with()`**: Starts with a prefix  


**`ends_with()`**: Ends with a suffix  


**`contains()`**: Contains a literal string 

---

## 📦 .red.b[`tidyselect`] helpers


.b[`matches()`] takes regular expressions, and selects variables that match a given pattern


.gray[
**`starts_with()`**: Starts with a prefix  
]

.gray[
**`ends_with()`**: Ends with a suffix  
]

.gray[
**`contains()`**: Contains a literal string 
]

---

### Selecting columns by name

`penguins` data from 📦 .red.b[`palmerpenguins`]


```r
names(penguins)
```

```
## [1] "species"           "island"            "bill_length_mm"   
## [4] "bill_depth_mm"     "flipper_length_mm" "body_mass_g"      
## [7] "sex"               "year"
```

.tinycode[

```r
penguins %&gt;% 
  select(species, bill_length_mm, flipper_length_mm) %&gt;% sample_n(3)
```

```
## # A tibble: 3 × 3
##   species bill_length_mm flipper_length_mm
##   &lt;fct&gt;            &lt;dbl&gt;             &lt;int&gt;
## 1 Gentoo            48.4               213
## 2 Adelie            41.1               192
## 3 Adelie            36.4               184
```
]


---

### Selecting columns by matches in variable names


```r
penguins %&gt;% 
  select(species, matches("length")) %&gt;% 
  sample_n(3)
```

```
## # A tibble: 3 × 3
##   species   bill_length_mm flipper_length_mm
##   &lt;fct&gt;              &lt;dbl&gt;             &lt;int&gt;
## 1 Gentoo              49.8               229
## 2 Gentoo              49.3               217
## 3 Chinstrap           43.5               202
```

---

### Match values and filter rows


Mammals sleep dataset (`msleep`) from 📦 .red.b[`ggplot2`]


```r
library(ggplot2)
```


```r
msleep %&gt;% select(name,genus) %&gt;% sample_n(4)
```

```
## # A tibble: 4 × 2
##   name                      genus     
##   &lt;chr&gt;                     &lt;chr&gt;     
## 1 Bottle-nosed dolphin      Tursiops  
## 2 Eastern american chipmunk Tamias    
## 3 African giant pouched rat Cricetomys
## 4 Macaque                   Macaca
```

---

### Match values and filter rows

Filter to keep rats only


```r
msleep %&gt;% 
  select(name,genus) %&gt;% 
  filter(str_detect(string = name,pattern = "rat"))
```

```
## # A tibble: 5 × 2
##   name                      genus     
##   &lt;chr&gt;                     &lt;chr&gt;     
## 1 African giant pouched rat Cricetomys
## 2 Round-tailed muskrat      Neofiber  
## 3 Laboratory rat            Rattus    
## 4 Cotton rat                Sigmodon  
## 5 Mole rat                  Spalax
```

---

class: inverse

## Practice

.f3[🐀 After running the code below, how can we exclude muskrats from the matches?]


```r
msleep %&gt;% 
  select(name,genus) %&gt;% 
  filter(str_detect(string = name,pattern = "rat"))
```

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"slideNumberFormat": "%current%",
"highlightStyle": "github",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
